name: Octopus Feature Deploy
on:
  push:
env:
  OCTOPUS_PROJECT_NAME: <REPLACE-THIS>
  OCTOPUS_SPACE_NAME: Engineering
  MASTER_BRANCH: master
jobs:
  octo:
    name: Push to Octopus
    runs-on: [eks]

    steps:
      - name: Checkout Code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Setup
        uses: variant-inc/actions-setup@v1
        id: lazy-setup

      - name: CI
        id: lazy-action
        uses: variant-inc/actions-dotnet@v1
        env:
          AWS_DEFAULT_REGION: us-east-1
          AWS_REGION: us-east-1
          GITHUB_USER: variant-inc
        with:
          src_file_dir_path: '.'
          dockerfile_dir_path: '.'
          nuget_push_enabled: 'false'
          nuget_push_token: ${{ secrets.GITHUB_TOKEN }}
          nuget_pull_token: ${{ secrets.PKG_READ }}
          container_push_enabled: 'true'
          ecr_repository: <REPLACE-THIS>
          sonar_scan_in_docker: 'false'

      - name: Action Octopus
        uses: variant-inc/actions-octopus@v2
        with:
          default_branch: ${{ env.MASTER_BRANCH }}
          project_name: ${{ env.OCTOPUS_PROJECT_NAME }}
          version: ${{ steps.lazy-setup.outputs.image_version }}
          space_name: ${{ env.OCTOPUS_SPACE_NAME }}
          charts_dir_path: helm/<REPLACE-THIS>
          is_infrastructure: false
